<!doctype html>
<html lang="ru">

<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="css/cinema-styles.css" type="text/css">

	<link rel="stylesheet" href="/css/icons/style.css" type="text/css">

	<link rel="stylesheet" href="/css/load_animation.css">

	<script src="/js/functions.js"></script>

	<!--Icons-->
	<link rel="apple-touch-icon" sizes="57x57" href="/androidIcons/apple-icon-57x57.png">
	<link rel="apple-touch-icon" sizes="60x60" href="/androidIcons/apple-icon-60x60.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/androidIcons/apple-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="76x76" href="/androidIcons/apple-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/androidIcons/apple-icon-114x114.png">
	<link rel="apple-touch-icon" sizes="120x120" href="/androidIcons/apple-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/androidIcons/apple-icon-144x144.png">
	<link rel="apple-touch-icon" sizes="152x152" href="/androidIcons/apple-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="/androidIcons/apple-icon-180x180.png">
	<link rel="apple-touch-icon" sizes="1024x1024" href="/androidIcons/apple-icon-1024x1024.png">
	<link rel="apple-touch-icon" sizes="1024x1024" href="/androidIcons/apple-icon-512x512.png">
	<link rel="icon" type="image/png" sizes="192x192" href="/androidIcons/android-icon-192x192.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/androidIcons/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="96x96" href="/androidIcons/favicon-96x96.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/androidIcons/favicon-16x16.png">
	<meta name="msapplication-TileColor" content="#ffffff">
	<meta name="msapplication-TileImage" content="ms-icon-144x144.png">
	<meta name="theme-color" content="#ffffff">

	<!--Manifest-->
	<link rel="manifest" href="/manifest.json">

	<meta name="mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="application-name" content="PWA">
	<meta name="apple-mobile-web-app-title" content="PWA">
	<meta name="msapplication-starturl" content="/">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<title>Синематограф</title>
</head>

<body>

	<!--Service worker-->
	<script>
		// Проверка того, что наш браузер поддерживает Service Worker API.
		if ('serviceWorker' in navigator) {
			// Весь код регистрации у нас асинхронный.
			navigator.serviceWorker.register('./sw.js')
				.then(() => navigator.serviceWorker.ready.then((worker) => {
					worker.sync.register('syncdata');
				}))
				.catch((err) => console.log(err));
		}
	</script>

	<!-- header -->
	<header class="header">
		<a class="header__logo" href="#"><img class="header__logo-img" src="images/logo.png" width="170" height="32"
				alt="" /></a>
		<button type="button" class="header__menu-button" data-toggle="offcanvas-menu" title="Toggle menu"></button>
		<div class="header__search">
			<div id="search-form">
				<input class="serach-form__input" type="text" placeholder="Поиск" id="search-bar" autocomplete="off">
				<button class="serach-form__button"></button>
			</div>
			<button type="button" class="header__search-btn-toggle" data-toggle="offcanvas-search"
				title="Toggle Search"></button>
		</div>
	</header>
	<!-- /header -->

	<div class="cnm-main-menu">
		<div class="main-menu-container">

			<!-- user authorizated -->
			<div class="main-menu-user" id="user_authorizated" style="display: none;">
				<div class="main-menu-user__info">
					<span class="main-menu-user__user-icon"></span>
					<span class="main-menu-user__user-name" id='user_name'>UserName</span>
				</div>
				<div class="main-menu-user__links">
					<button class="main-menu-user__link" type="button" data-toggle="modal"
						data-target="#modal__settings"><span class="cnm cnm-settings"></span>Настройки</button>
					<button class="main-menu-user__link" id="close_session"><span
							class="cnm cnm-close"></span>Выход</button>
				</div>
			</div>

			<!-- not authorizated -->
			<div class="main-menu-user main-menu-user_not_login" id="user_not_authorizated">
				<div class="main-menu-user__links">
					<button class="main-menu-user__link" type="button" data-toggle="modal"
						data-target="#modal__registration"><span
							class="cnm cnm-person_add"></span>Зарегистрироваться</button>
					<button class="main-menu-user__link" type="button" data-toggle="modal"
						data-target="#modal__login"><span class="cnm cnm-vpn_key"></span>Войти</button>
				</div>
			</div>
			<!-- main menu -->
			<div class="main-menu">
				<nav class="main-menu__items">
					<a class="main-menu__item main-menu__item_catalog" href="iptv.html">
						<div class="main-menu__item-icon">
							<span class="cnm cnm-ondemand_video"></span>
						</div>
						IPTV
					</a>
					<a class="main-menu__item main-menu__item_catalog" href="index.html">
						<div class="main-menu__item-icon">
							<span class="cnm cnm-view_module"></span>
						</div>
						Каталог фильмов
					</a>
					<a class="main-menu__item main-menu__item_categories" href="categories.html">
						<div class="main-menu__item-icon">
							<span class="cnm cnm-view_list"></span>
						</div>
						Жанры
					</a>
					<a class="main-menu__item main-menu__item_newest" href="newest.html">
						<div class="main-menu__item-icon">
							<span class="cnm cnm-movie_creation"></span>
						</div>
						Новинки
					</a>
					<a class="main-menu__item main-menu__item_top" href="top.html">
						<div class="main-menu__item-icon">
							<span class="cnm cnm-thumb_up"></span>
						</div>
						Топ недели
					</a>
					<a class="main-menu__item main-menu__item_fav" href="favorites.html" id="favorites"
						style="display: none;">
						<div class="main-menu__item-icon">
							<span class="cnm cnm-star"></span>
						</div>
						Избранное
					</a>
					<a class="main-menu__item main-menu__item_watched" href="watched.html" id="watched"
						style="display: none;">
						<div class="main-menu__item-icon">
							<span class="cnm cnm-watch_later"></span>
						</div>
						Недавно просмотренные
					</a>
					<a class="main-menu__item main-menu__item_search" href="search.html">
						<div class="main-menu__item-icon">
							<span class="cnm cnm-search"></span>
						</div>
						Расширенный поиск
					</a>
					<a class="main-menu__item main-menu__item_small main-menu__item_stats" href="stats.html">
						<div class="main-menu__item-icon">
							<span class="cnm cnm-pie_chart"></span>
						</div>
						Статистика cinema.ntop.tv
					</a>
					<a class="main-menu__item main-menu__item_small main-menu__item_feedback" data-toggle="modal"
						href="#modal__feedback">
						<div class="main-menu__item-icon">
							<span class="cnm cnm-message"></span>
						</div>
						Ваши пожелания
					</a>
				</nav>
			</div>
		</div>
	</div>


	<!-- CONTENT -->
	<!-- Анимация загрузки -->
	<div id="fountainG">
		<div id="fountainG_1" class="fountainG"></div>
		<div id="fountainG_2" class="fountainG"></div>
		<div id="fountainG_3" class="fountainG"></div>
		<div id="fountainG_4" class="fountainG"></div>
		<div id="fountainG_5" class="fountainG"></div>
		<div id="fountainG_6" class="fountainG"></div>
		<div id="fountainG_7" class="fountainG"></div>
		<div id="fountainG_8" class="fountainG"></div>
	</div>
	<main class="content" style="display: none;">
		<div class="top-bar">
			<h1 class="top-bar__title"><span class="cnm cnm-label_outline"></span><span class="title-sub">
					Жанр:</span><span id="genre_name">Биография</span></h1>
			<div class="top-bar__sort-wrapper">
				<div class="top-bar__item top-bar__sort-list-wrapper">
					<div class="dropdown top-bar__sort-list-dropdown">
						<button class="top-bar__sort-list-button dropdown-toggle" type="button" id="sort-list"
							data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							по дате добавления
						</button>
						<div class="dropdown-menu top-bar__sort-list-menu" aria-labelledby="sort-list"
							id="hidden-sort-list">
							<a data="0" class="dropdown-item active" href="#" onclick="sortMovie(this, 0)"><span
									class="cnm cnm-today"></span> по дате добавления</a>
							<a data="1" class="dropdown-item" href="#" onclick="sortMovie(this, 1)"><span
									class="cnm cnm-date_range"></span> по году выпуска</a>
							<a data="2" class="dropdown-item" href="#" onclick="sortMovie(this, 2)"><span
									class="cnm cnm-stars"></span> по рейтингу IMDb</a>
							<a data="9" class="dropdown-item" href="#" onclick="sortMovie(this, 9)"><span
									class="cnm cnm-stars"></span> по рейтингу KinoPoisk</a>
							<a data="3" class="dropdown-item" href="#" onclick="sortMovie(this, 3)"><span
									class="cnm cnm-thumbs_up_down"></span> по локальному рейтингу</a>
							<a data="4" class="dropdown-item" href="#" onclick="sortMovie(this, 4)"><span
									class="cnm cnm-thumb_up"></span> по персональному рейтингу</a>
							<a data="8" class="dropdown-item" href="#" onclick="sortMovie(this, 8)"><span
									class="cnm  cnm-star_border"></span> по относительной популярности</a>
							<a data="6" class="dropdown-item" href="#" onclick="sortMovie(this, 6)"><span
									class="cnm cnm-star"></span> по абсолютной популярности</a>
						</div>
					</div>
				</div>

				<div class="top-bar__item top-bar__serials-switch-wrapper">
					<div class="serials-switch top-bar__serials-switch">
						<input type="checkbox" class="serials-switch__input" id="show-serials" checked>
						<label class="serials-switch__label" for="show-serials" onclick="showSerials()">
							<span class="serials-switch__label-text">показывать<br>
								сериалы</span>
						</label>
					</div>
				</div>
			</div>
		</div>

		<div class="container-fluid cinema-content-wrapper cinema-items_var1">
			<div class="row no-gutters" id="place_for_films">


			</div>
		</div>

	</main>
	<!-- /CONTENT -->


	<!-- BOTTOM-BAR -->
	<div class="bottom-bar">
		<span class="bottom-bar__items-coount"><span id="film_count"></span> из <span id="total_count">'место для
				количества всех фильмов'</span></span>
		<button class="bottom-bar__nav-button bottom-bar__nav-button_prev" id="button_prev"></button>
		<button class="bottom-bar__nav-button bottom-bar__nav-button_next" id="button_next"></button>
	</div>
	<!-- /BOTTOM-BAR -->

	<!-- MODALS -->

	<!-- Modal - FEEDBACK -->
	<div class="modal fade" id="modal__feedback" tabindex="-1" role="dialog" aria-labelledby="modal__feedback"
		aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalCenterTitle">Ваши пожелания</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<form>
						<div class="form-group">
							<label for="feedback-message">Ваше сообщение</label>
							<textarea id="feedback-message" placeholder="Введите сообщение"
								class="form-control cnm-input"></textarea>
						</div>
						<div class="text-center py-2">
							<button type="submit" class="cnm-modal-btn">Отправить</button>
						</div>
					</form>
				</div>

			</div>
		</div>
	</div>


	<!-- Modal - SETTINGS -->
	<div class="modal fade" id="modal__settings" tabindex="-1" role="dialog" aria-labelledby="modal__settings"
		aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalCenterTitle">Настройки</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					...
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
					<button type="button" class="btn btn-primary">Save changes</button>
				</div>
			</div>
		</div>
	</div>


	<!-- Modal - LOGIN -->
	<div class="modal fade" id="modal__login" tabindex="-1" role="dialog" aria-labelledby="modal__login"
		aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="Login">Вход</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div id="form_login">
						<div class="form-group">
							<label for="login-username">Имя пользователя: <span class="text-danger"
									id="wrong_login_login" style="display: none;">Вы не ввели логин</span></label>
							<input type="text" class="form-control cnm-input" id="login-username"
								placeholder="Введите имя пользователя">
						</div>

						<div class="form-group">
							<label for="login-pass">Пароль: <span class="text-danger" id="wrong_login_pass"
									style="display: none;">Вы не ввели пароль</span></label>
							<input type="password" class="form-control cnm-input" id="login-pass" placeholder="Пароль">
						</div>

						<div class="form-group form-check text-center">
							<input type="checkbox" class="form-check-input" id="login-autologin">
							<label class="form-check-label" for="login-autologin">Автоматически входить</label>
						</div>


						<div class="text-center py-2">
							<button id="login_submit" class="cnm-modal-btn">Войти</button>
						</div>
					</div>

					<div class="p-4">
						<a href="#modal__registration" data-toggle="modal" class="float-left"><span
								class="cnm cnm-person_add"></span> Зарегистрироваться</a>
						<a href="#modal__forgotpass" data-toggle="modal" class="float-right"><span
								class="cnm cnm-help_outline"></span> Забыл пароль</a>
						<span class="clearfix"></span>

					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal - REGISTRATION -->
	<div class="modal fade" id="modal__registration" tabindex="-1" role="dialog" aria-labelledby="modal__registration"
		aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalCenterTitle">Регистрация</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div id="form_registration">
						<div class="form-group">
							<label for="reg-username">Имя пользователя:
								<span class="text-danger" id="wrong_registration_login" style="display: none;">
									Вы не ввели имя пользователя
								</span>
								<span class="text-danger" id="wrong_registration_login_long" style="display: none;">
									Логин содержит более 16 символов.
								</span>
								<span class="text-danger" id="wrong_registration_login_short" style="display: none;">
									Логин содержит менее 3 символов.
								</span>
							</label>
							<input type="text" class="form-control cnm-input" id="reg-username"
								placeholder="Введите имя пользователя">
						</div>
						<div class="form-group">
							<label for="reg-pass">Пароль:
								<span class="text-danger" id="wrong_registration_password" style="display: none;">
									Вы не ввели пароль
								</span>
								<span class="text-danger" id="wrong_registration_password_long" style="display: none;">
									Пароль содержит более 16 символов.
								</span>
								<span class="text-danger" id="wrong_registration_password_short" style="display: none;">
									Пароль содержит менее 3 символов.
								</span>
							</label>
							<input type="password" class="form-control cnm-input" id="reg-pass" placeholder="Пароль">
						</div>
						<div class="form-group">
							<label for="reg-repass">Повторите папроль:
								<span class="text-danger" id="wrong_registration_repassword" style="display: none;">
									Вы не повторили пароль
								</span>
								<span class="text-danger" id="wrong_registration_repassword_wrong"
									style="display: none;">
									Пароли не совпадают
								</span>
							</label>
							<input type="password" class="form-control cnm-input" id="reg-repass"
								placeholder="Повторите пароль">
						</div>
						<div class="form-group">
							<label for="reg-email">E-mail:
								<span class="text-danger" id="wrong_registration_email" style="display: none;">
									Вы не указали e-mail
								</span>
								<span class="text-danger" id="wrong_registration_email_false" style="display: none;">
									Проверьте правильность ввода e-mail
								</span>
							</label>
							<input type="text" class="form-control cnm-input" id="reg-email"
								placeholder="Введите e-mail">
						</div>
						<div class="form-group form-check text-center">
							<input type="checkbox" class="form-check-input" id="reg-autologin">
							<label class="form-check-label" for="reg-autologin">Автоматически входить</label>
						</div>

						<div class="text-center py-2">
							<button type="submit" id="register_submit" class="cnm-modal-btn">Зарегистрироваться</button>
						</div>
					</div>

					<div class="p-4">
						<a href="#modal__login" data-toggle="modal" class="float-left"><span
								class="cnm cnm-vpn_key"></span> Вход</a>
						<a href="#modal__forgotpass" data-toggle="modal" class="float-right"><span
								class="cnm cnm-help_outline"></span> Забыл пароль</a>
						<span class="clearfix"></span>

					</div>
				</div>
			</div>
		</div>
	</div>



	<!-- Modal - FORGOT PASSWORD -->
	<div class="modal fade" id="modal__forgotpass" tabindex="-1" role="dialog" aria-labelledby="modal__forgotpass"
		aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalCenterTitle">Восстановление пароля</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<form>
						<div class="form-group">
							<label for="forgot-pass-email">E-mail:</label>
							<input type="text" class="form-control cnm-input" id="forgot-pass-email"
								placeholder="Введите e-mail">
						</div>
						<div class="text-center py-2">
							<button type="submit" class="cnm-modal-btn">Восстановить</button>
						</div>
					</form>

					<div class="p-4">
						<a href="#modal__login" data-toggle="modal" class="float-left"><span
								class="cnm cnm-vpn_key"></span> Вход</a>
						<span class="clearfix"></span>

					</div>
				</div>
			</div>
		</div>
	</div>


	<!-- Optional JavaScript -->
	<!-- jQuery first, then Popper.js, then Bootstrap JS -->
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
		integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
		crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
		integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
		crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"
		integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T"
		crossorigin="anonymous"></script>


	<script>
		$(document).ready(function () {

			$('[data-toggle=offcanvas-menu]').click(function () {
				$('.cnm-main-menu').toggleClass('active');
				$('.header__menu-button').toggleClass('active');
			});

			$('[data-toggle=offcanvas-search]').click(function () {
				$('.header__search').toggleClass('active');
				$('.header__search-btn-toggle').toggleClass('active');
			});

		});

	</script>

	<script>
		const SHOW_SERIALS = true; // отображать сериалы
		const DONT_SHOW_SERIALS = false; // не отображать сериалы
		const NUMBER_OF_FILMS_PER_PAGE = 12;// количество фильмов на странице
		const REQUEST_URL_END = '&JsHttpRequest=16007667792177-xml';//окончание для REQUEST_URL

		// типы сортировки
		const DATE_ADDED = '&order[0]=0';
		const YEAR_RELEASE = '&order[0]=1';
		const RAITING_IMDB = '&order[0]=2';
		const RAITING_KINOPOISK = '&order[0]=9';
		const LOCAL_RAITING = '&order[0]=3';
		const PERSONAL_RAITING = '&order[0]=4';
		const RELATIVE_POPULARITY = '&order[0]=8';
		const ABSOLUTE_POPULARITY = '&order[0]=6';

		let currentMovieNumber = 0; //номер текущего фильма с которго начинаетяс отображение
		let SHOW_OPTION = SHOW_SERIALS; // параметр отображения - присваивается SHOW_SERIALS или DONT_SHOW_SERIALS
		let SORTING_TYPE = undefined; //тип сортировки - присваивается из const
		let TOTAL_FILM_COUNT = 0;//текущее количество всех фильмов
		let SEARCH_QUERY;

		// Получение данных из куки
		if (document.cookie.length > 0) {

			// Проверка "показывать сериалы"
			if (localStorage.getItem('showOptionCategory') == 'true') {
				SHOW_OPTION = SHOW_SERIALS;
			} else if ((localStorage.getItem('showOptionCategory')) == 'false') {
				SHOW_OPTION = DONT_SHOW_SERIALS;
			}

			// Получение текущего номера фильма	
			if (Number(localStorage.getItem('currentMovieNumberCategory') > 0)) {
				currentMovieNumber = Number(localStorage.getItem('currentMovieNumberCategory'));
			}

			// Получение типа сортировки
			SORTING_TYPE = localStorage.getItem('sortingTypeCategory');
		}

		function $_GET(key) {
			var p = window.location.search;
			p = p.match(new RegExp(key + '=([^&=]+)'));
			return p ? p[1] : false;
		}

		//Обработка "Показывать сериалы"
		function showSerials() {
			if (SHOW_OPTION == SHOW_SERIALS) {
				SHOW_OPTION = DONT_SHOW_SERIALS;
			} else {
				SHOW_OPTION = SHOW_SERIALS;
			}
			movieLoader(SHOW_OPTION, SORTING_TYPE);
		}

		//Обработка prev и next buttons
		let buttonNext = document.getElementById('button_next');
		let buttonPrev = document.getElementById('button_prev');

		buttonNext.onclick = function () {
			currentMovieNumber += NUMBER_OF_FILMS_PER_PAGE;
			movieLoader(SHOW_OPTION, SORTING_TYPE);
			window.scrollTo(0, 0);
		}
		buttonPrev.onclick = function () {
			if (currentMovieNumber > 0) {
				currentMovieNumber -= NUMBER_OF_FILMS_PER_PAGE;
				movieLoader(SHOW_OPTION, SORTING_TYPE);
			} else {
				console.log("Ты на первой странице");
			}
			window.scrollTo(0, 0);
		}

		//Функция для подгрузки фильмов
		//showOption - показывать сериалы или нет (Используется глобальная переменная SHOW_OPTION)
		//sortingType - тип сортировки (Используется глобальная переменная SORTING_TYPE)
		//primaryDownload - параметр, отображающий первичную загрузку. При передачи в качестве параметра true дополнительно будут загружаться списки стран, жанров и годов
		function movieLoader(showOption, sortingType, primaryDownload) {
			var REQUEST_URL = 'https://cinema.ntop.tv/api.php?format=ajax';

			if (getCookie('PHPSESSID')) {
				REQUEST_URL += `&PHPSESSID=${getCookie('PHPSESSID')}&action[2]=Video.getBookmarks`;
			}
			if (primaryDownload == true) {
				REQUEST_URL += '&action[0]=Video.getCatalog&action[1]=Video.getGenres';
			}
			if (showOption == SHOW_SERIALS) {
				REQUEST_URL += '&action[0]=Video.getCatalog&offset[0]=' + currentMovieNumber + '&size[0]=' + NUMBER_OF_FILMS_PER_PAGE + '&genre[0]=' + $_GET('id');
			} else {
				REQUEST_URL += '&action[0]=Video.getCatalog&offset[0]=' + currentMovieNumber + '&size[0]=' + NUMBER_OF_FILMS_PER_PAGE + '&genre[0]=' + $_GET('id') + '%2C%2134%7C0';
			}
			if (sortingType != undefined) {
				REQUEST_URL += sortingType;
			}
			REQUEST_URL += REQUEST_URL_END;
			console.log(REQUEST_URL);

			xhr = new XMLHttpRequest();
			xhr.open('POST', REQUEST_URL);
			xhr.responseType = 'json';
			xhr.send();
			var result = '';
			xhr.onreadystatechange = function () {
				//Провекрка на статус выполненяи запроса. Если запрос выполнен(xhr.readyState == XMLHttpRequest.DONE) и был возвращен ответ(xhr.status == 200)
				//идет дальнейшая обработка. В случае сбоя идет обработка ошибки
				if (xhr.readyState == XMLHttpRequest.DONE && xhr.status == 200) {
					let films = xhr.response;

					if (primaryDownload == true) {
						showGenreName(films, $_GET('id'));
					}
					let movie = films['js']['0']['response']['movies'];

					let favorites_id = new Array();

					if (getCookie('PHPSESID')) {
						let favorites = films['js'][2]['response']['movies'];

						for (let i = 0; i < favorites.length; i++) {
							favorites_id[i] = favorites[i]['movie_id'];
						}
					}

					for (let key in movie) {
						let href = 'movie-page.html?id=' + movie[key]['movie_id'];;
						let title = movie[key]['name'];
						let posterImage = 'https://cinema.ntop.tv' + movie[key]['cover_original'];

						let popular = (movie[key]['popular'] == 1) ? '<span class="cinema-item__poster-icon cinema-item__poster-icon_top" data-toggle="tooltip" data-placement="top" title="Хит!"></span>' : '';
						let hd = (movie[key]['hd'] == 1) ? '<span class="cinema-item__poster-icon cinema-item__poster-icon_hd" data-toggle="tooltip" data-placement="top" title="HD качество"></span>' : '';
						let seriesStatus = (movie[key]['StatusSeries'] == 1) ? '<span class="cinema-item__poster-icon cinema-item__poster-icon_series_add" data-toggle="tooltip" data-placement="top" title="Серии добаляются"></span>' : ((movie[key]['StatusSeries'] == 2) ? '<span class="cinema-item__poster-icon cinema-item__poster-icon_series_end" data-toggle="tooltip" data-placement="top" title="Сериал завершен"></span>' : '');

						let favorite = '';


						if (getCookie('PHPSESSID')) {
							for (let i = 0; i < favorites_id.length; i++) {
								if (favorites_id[i] == movie[key]['movie_id']) {
									favorite = '<span class="cinema-item__poster-icon cinema-item__poster-icon_series_favorite" data-toggle="tooltip" data-placement="top" title="В избранном"></span>';
									break;
								}
							}
						}

						let year = movie[key]['year'];
						var countries = '';
						for (let countryKey in movie[key]['countries']) {
							countries += movie[key]['countries'][countryKey] + ' / ';
						}
						countries = countries.substring(0, (countries.length - 2));
						var genres = '';
						for (let genreKey in movie[key]['countries']) {
							genres += movie[key]['genres'][genreKey] + ' / ';
						}
						genres = genres.substring(0, (genres.length - 2));

						let template = "<div class=\"col-6 col-sm-4 col-md-3 col-lg-2\">" +
							"<div class=\"cinema-item\">" +
							"<a href=\"" + href + "\" class=\"cinema-item__link\">" +
							"<div class=\"cinema-item__poster-wrap\">" +
							"<div class=\"cinema-item__poster-icons\">" +
							popular + hd + seriesStatus + favorite +
							"</div>" +
							"<img class=\"cinema-item__poster-img\" src=\"" + posterImage + "\" alt=\"\"/>" +
							"</div>" +
							"<p class=\"cinema-item__title\">" + ((title.indexOf('(') > 0) ? (title.substring(0, title.indexOf('(')) + "<span class=\"cinema-item__title-season\">" + title.substring(title.indexOf('('))) : (title)) + "</span></p>" +
							"<p class=\"cinema-item__info\"><span class=\"cinema-item__info_country\">" + year + ", " + countries + "</span>" +
							"" + genres + "</p>" +
							"<span class=\"cinema-item__serial-label\">обновляется</span>" +
							"</a>" +
							"</div>" +
							"</div>";
						result += template;
					}
					document.getElementById('place_for_films').innerHTML = result;

					let TOTAL_FILM_COUNT = films['js']['0']['response']['total'];

					if (NUMBER_OF_FILMS_PER_PAGE > TOTAL_FILM_COUNT) {
						document.getElementById('film_count').innerText = (currentMovieNumber + 1) + ' - ' + (TOTAL_FILM_COUNT);
					} else {
						document.getElementById('film_count').innerText = (currentMovieNumber + 1) + ' - ' + (currentMovieNumber + NUMBER_OF_FILMS_PER_PAGE);
					}

					document.getElementById('total_count').innerText = TOTAL_FILM_COUNT;
				} else if (xhr.readyState == XMLHttpRequest.DONE && xhr.status == 404) {
					document.write('Ошибка получения данных');
				}
			}
		}

		function showGenreName(films, id) {
			for (let key in films['js']['1']['response']['genres']) {
				if (films['js']['1']['response']['genres'][key]['id'] == id) {
					document.getElementById('genre_name').innerText = films['js']['1']['response']['genres'][key]['name'];
				}

			}
		}

		//Сортировка фильмов
		function sortMovie(sortElem, id) {
			let dropdownButton = document.getElementById('sort-list');//кнопка, вызывающая выпадающий список с типами сортировки
			let sortElemCurrent = document.getElementsByClassName('dropdown-item');
			for (let i = 0; i < sortElemCurrent.length; i++) {
				sortElemCurrent[i].classList.remove('active');
			}

			sortElem.classList.add('active');
			dropdownButton.innerText = sortElem.innerText;

			switch (id.toString()) {
				case DATE_ADDED[DATE_ADDED.length - 1]:
					SORTING_TYPE = DATE_ADDED;
					break;
				case YEAR_RELEASE[YEAR_RELEASE.length - 1]:
					SORTING_TYPE = YEAR_RELEASE;
					break;
				case RAITING_IMDB[RAITING_IMDB.length - 1]:
					SORTING_TYPE = RAITING_IMDB;
					break;
				case RAITING_KINOPOISK[RAITING_KINOPOISK.length - 1]:
					SORTING_TYPE = RAITING_KINOPOISK
					break;
				case LOCAL_RAITING[LOCAL_RAITING.length - 1]:
					SORTING_TYPE = LOCAL_RAITING;
					break;
				case PERSONAL_RAITING[PERSONAL_RAITING.length - 1]:
					SORTING_TYPE = PERSONAL_RAITING;
					break;
				case RELATIVE_POPULARITY[RELATIVE_POPULARITY.length - 1]:
					SORTING_TYPE = RELATIVE_POPULARITY;
					break;
				case ABSOLUTE_POPULARITY[ABSOLUTE_POPULARITY.length - 1]:
					SORTING_TYPE = ABSOLUTE_POPULARITY;
					break;
				default:
					console.log("Ошибка в сортировке");
			}
			movieLoader(SHOW_OPTION, SORTING_TYPE);
		}

		//----------------------------------------------------------------------------------------------
		//-----------------------------------------Авторизация------------------------------------------
		//----------------------------------------------------------------------------------------------

		function authorization() {
			let login = document.getElementById('login-username');
			let password = document.getElementById('login-pass');
			let remember = (document.getElementById('login-autologin').checked) ? 1 : 0;

			if (login.value.length <= 0 || password.value.length <= 0) {
				if (login.value.length <= 0) {
					document.getElementById('wrong_login_login').style.display = 'inline-block';
					login.style.borderColor = 'red';
				}
				if (password.value.length <= 0) {
					document.getElementById('wrong_login_pass').style.display = 'inline-block';
					password.style.borderColor = 'red';
				}

			} else {
				document.getElementById('wrong_login_login').style.display = 'none';
				document.getElementById('wrong_login_pass').style.display = 'none';
				password.style.borderColor = '#c1c1c1';
				login.style.borderColor = '#c1c1c1';

				let xhr = new XMLHttpRequest();
				let request = `https://cinema.ntop.tv/api.php?format=ajax&action[0]=Video.login&login[0]=${login.value}&pass[0]=${password.value}&remember[0]=${remember}&JsHttpRequest=16063651671721-xml`;

				xhr.open('POST', request);
				xhr.responseType = 'json';

				xhr.send();

				xhr.onreadystatechange = function () {
					if (xhr.readyState == XMLHttpRequest.DONE && xhr.status == 200) {
						let result = xhr.response;
						result = result['js'][0];
						if (result['status'] == 200) {
							setCookie('PHPSESSID', result['response']['PHPSESSID']);

							document.getElementById('user_authorizated').style.display = 'block';
							document.getElementById('user_not_authorizated').style.display = 'none';
							document.getElementById('modal__login').getElementsByTagName('button')[0].click();

							document.getElementsByTagName('header')[0].getElementsByTagName('button')[0].click();

							document.getElementById('favorites').style.display = 'block';

							setCookie('login', login.value);
							document.getElementById('user_name').innerText = login.value;



						} else if (result['status'] == 300) {

							let warning = document.createElement('p');
							warning.classList.add('text-danger');
							warning.classList.add('text-danger');
							warning.classList.add('text-center');
							warning.innerText = result['response'];
							document.getElementById('form_login').prepend(warning);

							login.style.borderColor = 'red';
							login.value = '';

							password.style.borderColor = 'red';
							password.value = '';

						}

					}
				}


			}
		}

		document.getElementById('login_submit').addEventListener('click', function () {
			authorization();
		});

		document.getElementById('modal__login').addEventListener('keypress', function (event) {
			let enterCode = 13;
			if(event.keyCode == enterCode){
				authorization();
			}
		});

		//Обработчик на закрытие формы авторизации
		document.getElementById('modal__login').addEventListener('click', function () {
			let elem = this;
			setTimeout(function () {
				if (elem.classList.length <= 2) {
					let login = document.getElementById('login-username');
					login.style.borderColor = '#c1c1c1';
					login.value = '';

					let password = document.getElementById('login-pass');
					password.style.borderColor = '#c1c1c1';
					password.value = '';

					document.getElementById('login-autologin').checked = false;

					document.getElementById('wrong_login_login').style.display = 'none';
					document.getElementById('wrong_login_pass').style.display = 'none';

					if (document.getElementById('form_login').children[0].tagName == 'P') {
						document.getElementById('form_login').children[0].remove();
					}
				}
			}, 100);
		});


		//----------------------------------------------------------------------------------------------
		//-----------------------------------------Регистрация------------------------------------------
		//----------------------------------------------------------------------------------------------

		document.getElementById('register_submit').addEventListener('click', function () {
			let formRegistration = document.getElementById('modal__registration');

			let login = document.getElementById('reg-username');
			let password = document.getElementById('reg-pass');
			let repassword = document.getElementById('reg-repass');
			let email = document.getElementById('reg-email');
			let remember = (document.getElementById('reg-autologin').checked) ? 1 : 0;

			if ((login.value.length <= 0) || (password.value.length <= 0) || (repassword.value.length <= 0) || (email.value.length <= 0)) {
				if (login.value.length <= 0) {
					document.getElementById('wrong_registration_login').style.display = 'inline-block';
					login.style.borderColor = 'red';
				}
				if (password.value.length <= 0) {
					document.getElementById('wrong_registration_password').style.display = 'inline-block';
					password.style.borderColor = 'red';
				}
				if (repassword.value.length <= 0) {
					document.getElementById('wrong_registration_repassword').style.display = 'inline-block';
					repassword.style.borderColor = 'red';
				}
				if (email.value.length <= 0) {
					document.getElementById('wrong_registration_email').style.display = 'inline-block';
					email.style.borderColor = 'red';
				}
			} else {
				let xhr = new XMLHttpRequest();
				let request = `https://cinema.ntop.tv/api.php?format=ajax&action[0]=Video.register&login[0]=${login.value}&pass[0]=${password.value}&pass2[0]=${repassword.value}&email[0]=${email.value}&remember[0]=${remember}&JsHttpRequest=16063651671721-xml`;
				
				xhr.open('POST', request, true);
				xhr.responseType = 'json';

				xhr.send();

				xhr.onreadystatechange = function () {
					if (xhr.readyState == XMLHttpRequest.DONE && xhr.status == 200) {
						let result = xhr.response;
						result = result['js'][0];

						if (result['status'] == 300) {
							login.style.borderColor = '#c1c1c1';
							password.style.borderColor = '#c1c1c1';
							repassword.style.borderColor = '#c1c1c1';
							email.style.borderColor = '#c1c1c1';

							document.getElementById('wrong_registration_login').style.display = 'none';
							document.getElementById('wrong_registration_login_short').style.display = 'none';
							document.getElementById('wrong_registration_login_long').style.display = 'none';

							document.getElementById('wrong_registration_password').style.display = 'none';
							document.getElementById('wrong_registration_password_short').style.display = 'none';
							document.getElementById('wrong_registration_password_long').style.display = 'none';

							document.getElementById('wrong_registration_repassword').style.display = 'none';
							document.getElementById('wrong_registration_repassword_wrong').style.display = 'none';

							document.getElementById('wrong_registration_email').style.display = 'none';
							document.getElementById('wrong_registration_email_false').style.display = 'none';

							if (document.getElementById('form_registration').children[0].tagName == 'P') {
								document.getElementById('form_registration').children[0].remove();
							}

							switch (result['response']) {
								case 'Ошибка. Логин содержит более 16 символов':
									document.getElementById('wrong_registration_login').style.display = 'none';
									document.getElementById('wrong_registration_login_short').style.display = 'none';
									document.getElementById('wrong_registration_login_long').style.display = 'inline-block';
									login.style.borderColor = 'red';
									break;
								case 'Ошибка. Логин содержит менее 3 символов':
									document.getElementById('wrong_registration_login').style.display = 'none';
									document.getElementById('wrong_registration_login_short').style.display = 'inline-block';
									document.getElementById('wrong_registration_login_long').style.display = 'none';
									login.style.borderColor = 'red';
									break;
								case 'Ошибка. Пароль содержит более 16 символов':
									document.getElementById('wrong_registration_password').style.display = 'none';
									document.getElementById('wrong_registration_password_short').style.display = 'none';
									document.getElementById('wrong_registration_password_long').style.display = 'inline-block';
									password.style.borderColor = 'red';
									break;
								case 'Ошибка. Пароль содержит менее 3 символов':
									document.getElementById('wrong_registration_password').style.display = 'none';
									document.getElementById('wrong_registration_password_short').style.display = 'inline-block';
									document.getElementById('wrong_registration_password_long').style.display = 'none';
									password.style.borderColor = 'red';
									break;
								case 'Ошибка. Пароли не совпадают':
									document.getElementById('wrong_registration_repassword').style.display = 'none';
									document.getElementById('wrong_registration_repassword_wrong').style.display = 'inline-block';
									repassword.style.borderColor = 'red';
									break;
								case 'Проверьте правильность ввода email':
									document.getElementById('wrong_registration_email').style.display = 'none';
									document.getElementById('wrong_registration_email_false').style.display = 'inline-block';
									email.style.borderColor = 'red';
									break;
								case 'Ошибка. Выбранный Вами логин уже занят':
									let warning = document.createElement('p');
									warning.classList.add('text-danger');
									warning.classList.add('text-danger');
									warning.classList.add('text-center');
									warning.innerText = result['response'];
									document.getElementById('form_registration').prepend(warning);
									break;
							}
						} else if (result['status'] == 200) {
							setCookie('PHPSESSID', result['response']['PHPSESSID']);
							setCookie('login', login.value);
							document.getElementById('user_name').innerText = login.value;


							document.getElementById('user_authorizated').style.display = 'block';
							document.getElementById('user_not_authorizated').style.display = 'none';
							document.getElementById('modal__login').getElementsByTagName('button')[0].click();

							document.getElementsByTagName('header')[0].getElementsByTagName('button')[0].click();

							document.getElementById('favorites').style.display = 'block';

						}
					}
				}
			}
		});

		//Обработчик на закрытие формы регистрации
		document.getElementById('modal__registration').addEventListener('click', function () {
			let elem = this;
			setTimeout(function () {
				if (elem.classList.length <= 2) {
					let login = document.getElementById('reg-username');
					login.style.borderColor = '#c1c1c1';
					login.value = '';

					let password = document.getElementById('reg-pass');
					password.style.borderColor = '#c1c1c1';
					password.value = '';

					let repassword = document.getElementById('reg-repass');
					repassword.style.borderColor = '#c1c1c1';
					repassword.value = '';

					let email = document.getElementById('reg-email');
					email.style.borderColor = '#c1c1c1';
					email.value = '';

					document.getElementById('reg-autologin').checked = false;

					document.getElementById('wrong_registration_login').style.display = 'none';
					document.getElementById('wrong_registration_login_long').style.display = 'none';
					document.getElementById('wrong_registration_login_short').style.display = 'none';

					document.getElementById('wrong_registration_password').style.display = 'none';
					document.getElementById('wrong_registration_password_long').style.display = 'none';
					document.getElementById('wrong_registration_password_short').style.display = 'none';

					document.getElementById('wrong_registration_repassword').style.display = 'none';
					document.getElementById('wrong_registration_repassword_wrong').style.display = 'none';

					document.getElementById('wrong_registration_email').style.display = 'none';
					

					if (document.getElementById('form_registration').children[0].tagName == 'P') {
						document.getElementById('form_registration').children[0].remove();
					}
				}
			}, 100);
		});


		//----------------------------------------------------------------------------------------------
		//---------------------------------------------Выход--------------------------------------------
		//----------------------------------------------------------------------------------------------
		document.getElementById('close_session').addEventListener('click', function () {
			let xhr = new XMLHttpRequest();
			let request = `https://cinema.ntop.tv/api.php?format=ajax&action[0]=Video.logout&JsHttpRequest=16063651671721-xml`;
			
			xhr.open('POST', request);
			xhr.responseType = 'json';

			xhr.send();

			xhr.onreadystatechange = function () {
				if (xhr.readyState == XMLHttpRequest.DONE && xhr.status == 200) {

					document.getElementById('user_authorizated').style.display = 'none';
					document.getElementById('user_not_authorizated').style.display = 'block';

					document.getElementsByTagName('header')[0].getElementsByTagName('button')[0].click();

					document.getElementById('favorites').style.display = 'none';

					deleteCookie('PHPSESSID');
					deleteCookie('login');
				}
			}
		});


		window.onload = function () {
			pageOpen();
			//----------------------------------------------------------------------------------------------
			//--------------------Отображение авторизованного пользователя----------------------------------
			//----------------------------------------------------------------------------------------------

			if (getCookie('PHPSESSID')) {
				document.getElementById('user_authorizated').style.display = 'block';
				document.getElementById('user_not_authorizated').style.display = 'none';
				document.getElementById('favorites').style.display = 'block';
				document.getElementById('user_name').innerText = getCookie('login');
			}

			//----------------------------------------------------------------------------------------------
			//------------------------Отображение 'Недавно просмотренные'-----------------------------------
			//----------------------------------------------------------------------------------------------
			if (localStorage.getItem('last')) {
				document.getElementById('watched').style.display = 'block';
			}


			//----------------------------------------------------------------------------------------------
			//-----------------------------------Первичная загрузка-----------------------------------------
			//----------------------------------------------------------------------------------------------
			movieLoader(SHOW_OPTION, SORTING_TYPE, true);
			if (SHOW_OPTION == SHOW_SERIALS) {
				document.getElementById('show-serials').checked = true;
			} else {
				document.getElementById('show-serials').checked = false;
			}
			if (SORTING_TYPE != undefined) {
				try {
					let sortElemCurrent = document.getElementsByClassName('dropdown-item')[0];
					sortElemCurrent.classList.remove('active');
					let sortElem = document.querySelector('a[data="' + SORTING_TYPE[SORTING_TYPE.length - 1] + '"]');
					sortElem.classList.add('active');
					document.getElementById('sort-list').innerText = sortElem.innerText;
					sortElemCurrent = sortElemCurrent[0];
				} catch (e) {
					console.error(e);
				}

			}


			//----------------------------------------------------------------------------------------------
			//---------------------------------------Работа поиска------------------------------------------
			//----------------------------------------------------------------------------------------------
			let searchForm = document.getElementById('search-form');//элемен поиска
			let searchFormButton = searchForm.getElementsByTagName('button')[0];//кнопка поиска
			console.log(searchForm.offsetWidth);

			//Начало поиска при клике на 'Enter'
			searchForm.addEventListener("keypress", function (event) {
				let keyEnter = 13;//13 - код клавиши 'ENTER'. по нажатию этой клавиши будет выполняться поиск
				let searchBar = document.getElementById('search-bar');//поле ввода поискового запроса
				if (event.keyCode == keyEnter) {
					var query = '';//запрос

					//перевод символов из поискового запроса в 16-ричную систему
					for (let i = 0; i < searchBar.value.length; i++) {
						query += '%u' + searchBar.value.charCodeAt(i).toString(16);
					}
					sessionStorage.setItem('query', searchBar.value);

					//переход на страницу с результатами поиска. поисковой запрос передается GET-методом с идентификатором 'query'
					document.location.href = "/search_result.html?query=" + query;
					//search();
				}
				//Запуск мгновенного поиска
				if (searchBar.value != '') {
					if (document.getElementById('field-search-result') != undefined) {
						document.getElementById('field-search-result').remove();
					}
					search(searchBar.value, searchForm);
				}

			});

			//Отправка поискового запроса при повторном фокусе поля поиска
			document.getElementById('search-bar').addEventListener('focus', function () {
				let searchBar = document.getElementById('search-bar');//поле ввода поискового запроса
				var query = '';//запрос

				//перевод символов из поискового запроса в 16-ричную систему
				for (let i = 0; i < this.value.length; i++) {
					query += '%u' + this.value.charCodeAt(i).toString(16);
				}
				sessionStorage.setItem('query', searchBar.value);

				//Запуск мгновенного поиска
				if (this.value != '') {
					if (document.getElementById('field-search-result') != undefined) {
						document.getElementById('field-search-result').remove();
					}
					search(this.value, searchForm);
				}
			});

			//Начало поиска при клике на кнопку поиска
			searchFormButton.addEventListener('click', function () {
				let searchBar = document.getElementById('search-bar');//поле ввода поискового запроса
				var query = '';//запрос

				//перевод символов из поискового запроса в 16-ричную систему
				for (let i = 0; i < searchBar.value.length; i++) {
					query += '%u' + searchBar.value.charCodeAt(i).toString(16);
				}
				sessionStorage.setItem('query', searchBar.value);

				//переход на страницу с результатами поиска. поисковой запрос передается GET-методом с идентификатором 'query'
				document.location.href = "/search_result.html?query=" + query;
				//search();
			});

			//Удаление мгновенного поиска при потере фокуса поля ввода
			searchForm.addEventListener('focusout', function () {
				if (document.getElementById('field-search-result') != undefined) {
					function removeFieldResult() {
						document.getElementById('field-search-result').remove();
					}
					setTimeout(removeFieldResult, 250);
				}
			});


			//-------------------------------------------------------------------------------------
			//----------------------------Отображение содержимого----------------------------------
			//-------------------------------------------------------------------------------------
			function show() {
				document.getElementById('fountainG').remove();//удаление анимации загрузки
				document.getElementsByTagName('main')[0].style.display = 'block';//отображение содержимого страницы
			}
			setTimeout(show, 1000);
		}

		//----------------------------------------------------------------------------------------------
		//-------------------Сохранение данных перед переходом на другую страницу-----------------------
		//----------------------------------------------------------------------------------------------

		window.onunload = function () {
			localStorage.setItem('showOptionCategory', SHOW_OPTION);
			localStorage.setItem('currentMovieNumberCategory', currentMovieNumber);
			localStorage.setItem('sortingTypeCategory', SORTING_TYPE);

			pageClose();
		}


		//----------------------------------------------------------------------------------------------
		//-------------------Очистка данных перед переходом со страницы с помощью меню------------------
		//----------------------------------------------------------------------------------------------
		document.getElementsByClassName('main-menu__items')[0].addEventListener('click', function (event) {
			let wishes = document.getElementsByClassName('main-menu__item_feedback')[0];
			if(event.target != wishes){
				SHOW_OPTION = SHOW_SERIALS;
				currentMovieNumber = 0;
				SORTING_TYPE = undefined;
			}
		});

	</script>
</body>

</html>